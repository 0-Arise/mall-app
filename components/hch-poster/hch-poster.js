(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/hch-poster/hch-poster"],{5019:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{}},props:{canvasFlag:{type:Boolean,default:!0},posterObj:{type:Object,default:{url:"",icon:"",title:"",discountPrice:"250.00",orignPrice:"300.00",code:""}}},methods:{roundRect:function(t,e,n,o,a,i,s,l,r){if(t.beginPath(),t.arc(e+i,n+i,i,Math.PI,1.5*Math.PI),t.moveTo(e+i,n),t.lineTo(e+o-i,n),t.arc(e+o-i,n+i,i,1.5*Math.PI,2*Math.PI),t.lineTo(e+o,n+a-i),t.arc(e+o-i,n+a-i,i,0,.5*Math.PI),t.arc(e+i,n+a-i,i,.5*Math.PI,Math.PI),t.lineTo(e,n+i),"btn"==r){var c=t.createLinearGradient(0,0,200,0);c.addColorStop(0,s),c.addColorStop(1,l),t.setFillStyle(c),t.fill()}else s&&(t.setFillStyle(s),t.fill()),l&&(t.setStrokeStyle(l),t.stroke());t.closePath(),t.clip()},canvasMultiLineText:function(t,e,n,o){for(var a=e.split(""),i="",s=[],l=0;l<a.length;l++)t.measureText(i).width<n?i+=a[l]:(l--,s.push(i),i="");if(s.push(i),s.length>o){for(var r=s.slice(0,o),c=r[1],h="",f=[],u=0;u<c.length;u++){if(!(t.measureText(h).width<n))break;h+=c[u]}f.push(h);var d=f[0]+"...";r.splice(o-1,1,d),s=r}return s},createCanvasImage:function(){console.log(this.posterObj),wx.showLoading({title:"海报生成中..."});var e=this,n=wx.getSystemInfoSync();this.phoneH=n.windowHeight,this.phoneW=n.windowWidth;this.phoneW;var o=this.phoneH/667;console.log(this.phoneH,this.phoneW);var a=wx.createCanvasContext("myCanvas"),i=this.posterObj.url,s=(this.posterObj.icon,this.posterObj.code),l="https://auu.oss-cn-hangzhou.aliyuncs.com/close.png";a.draw(),a.save(),this.roundRect(a,50,40,this.phoneW-100,this.phoneH-100,10,"#FFFFFF","#FFFFFF"),a.restore(),a.save(),this.roundRect(a,50,40,this.phoneW-100,360*o,10,"#f7f7f7","#f7f7f7"),a.restore(),wx.getImageInfo({src:i,success:function(t){a.save(),e.roundRect(a,(e.phoneW-(e.phoneW-110))/2,55,e.phoneW-110,240*o,10,"#f7f7f7","#f7f7f7"),a.drawImage(t.path,(e.phoneW-(e.phoneW-110))/2,55,e.phoneW-110,240*o,10),a.restore(),a.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),wx.getImageInfo({src:l,success:function(t){a.drawImage(t.path,e.phoneW-100+50+5,40,24,24),a.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),a.setGlobalAlpha(1),a.setFillStyle("#1c1c1c"),a.setFontSize(14),a.font="normal bold 14px sans-serif";for(var r=this.posterObj.title,c=this.canvasMultiLineText(a,r,this.phoneW-130,2),h=350,f=65,u=12,d=0;d<c.length;d++)a.fillText(c[d],f,(h+u*d-15)*o,this.phoneW-130),a.draw(!0);wx.getImageInfo({src:this.posterObj.avatarUrl,success:function(t){a.drawImage(t.path,65,370*o,50,50),a.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),a.setGlobalAlpha(1),a.setFillStyle("#c2c291"),a.setFontSize(12),a.font="normal bold 14px sans-serif";for(var p=this.posterObj.nickName,v=this.canvasMultiLineText(a,p,80,3),g=440*o,w=65,F=15,x=0;x<v.length;x++)a.fillText(v[x],w,(g+F*x-15)*o,this.phoneW-130),a.draw(!0);var m="推荐价",b=a.measureText(m).width;a.fillText(m,120,400*o,b),a.setFontSize(14),a.setFillStyle("#c00000"),a.font="normal 12px sans-serif",a.fillText("￥",140+b,400*o,20),a.setFontSize(20);var T=this.posterObj.discountPrice,S=a.measureText(T).width;a.fillText(T,150+b,400*o,S),a.beginPath(),a.setFontSize(16),a.setFillStyle("#999999");var I=this.posterObj.orignPrice,W=a.measureText(I).width;a.fillText("￥".concat(I),150+b+S+5,400*o,W),a.moveTo(150+b+S+5,395*o),a.lineTo(150+b+S+5+W,395*o),a.setStrokeStyle("#999999"),a.stroke(),a.closePath(),wx.getImageInfo({src:s,success:function(t){a.drawImage(t.path,(e.phoneW-60)/2,430*o,70,70),a.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"小程序码生成失败",duration:2e3,icon:"none"})}}),a.setFontSize(14),a.setFillStyle("#2f1709"),a.fillText(this.posterObj.shopName,(e.phoneW-60)/2,520*o,90),a.setFontSize(14),a.setFillStyle("#ff5f33"),a.font="normal 14px sans-serif",a.fillText("长按/扫描识别查看商品",(e.phoneW-140)/2,550*o,140),a.save(),this.roundRect(a,(this.phoneW-160)/2,this.phoneH-70,160,36,18,"#ff3600","#ff6a00","btn"),a.restore(),a.setFontSize(14),a.setFillStyle("#FFFFFF"),a.font="normal bold 14px sans-serif",a.fillText("保存图片",(e.phoneW-58)/2,this.phoneH-45,58),wx.hideLoading()},saveCanvasImage:function(){wx.showLoading({title:"保存中..."});var e=this;t.canvasToTempFilePath({x:50,y:45,width:this.phoneW-100,height:this.phoneH-120,destWidth:5*(this.phoneW-100),destHeight:5*(this.phoneH-120),canvasId:"myCanvas",success:function(n){t.saveImageToPhotosAlbum({filePath:n.tempFilePath,success:function(n){wx.hideLoading(),t.showToast({title:"图片保存成功，可以去分享啦~",duration:2e3}),e.canvasCancelEvn()},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},canvasCancelEvn:function(){this.$emit("cancel",!0)}}};e.default=n}).call(this,n("543d")["default"])},"6b9a":function(t,e,n){"use strict";n.r(e);var o=n("5019"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e["default"]=a.a},"70a5":function(t,e,n){"use strict";n.r(e);var o=n("8484"),a=n("6b9a");for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);n("97aa");var s,l=n("f0c5"),r=Object(l["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=r.exports},"7db0":function(t,e,n){},8484:function(t,e,n){"use strict";var o,a=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",function(){return a}),n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o})},"97aa":function(t,e,n){"use strict";var o=n("7db0"),a=n.n(o);a.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/hch-poster/hch-poster-create-component',
    {
        'components/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("70a5"))
        })
    },
    [['components/hch-poster/hch-poster-create-component']]
]);
