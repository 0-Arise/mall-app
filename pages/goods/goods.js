(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goods"],{"06c7":function(t,e,s){"use strict";s.r(e);var o=s("fdbb"),i=s("a69d");for(var n in i)"default"!==n&&function(t){s.d(e,t,function(){return i[t]})}(n);s("21f8");var a,r=s("f0c5"),c=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);e["default"]=c.exports},"21f8":function(t,e,s){"use strict";var o=s("b7d0"),i=s.n(o);i.a},2929:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s("9e95"),i=(s("cf36"),s("e228")),n=s("7416");function a(t){return l(t)||c(t)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function l(t){if(Array.isArray(t)){for(var e=0,s=new Array(t.length);e<t.length;e++)s[e]=t[e];return s}}var h=function(){return s.e("components/uni-fab/uni-fab").then(s.bind(null,"e60e"))},d=function(){return Promise.all([s.e("common/vendor"),s.e("components/uni-icons/uni-icons")]).then(s.bind(null,"fdd6"))},g=function(){return s.e("components/hch-poster/hch-poster").then(s.bind(null,"70a5"))},f={components:{uniFab:h,uniIcons:d,hchPoster:g},data:function(){return{userId:null,baseUrl:o.requestURL,beforeHeaderzIndex:11,afterHeaderzIndex:10,beforeHeaderOpacity:1,afterHeaderOpacity:0,swiperList:[],currentSwiper:0,anchorlist:[],selectAnchor:0,serviceClass:"hide",shareClass:"none",buylist:[],goodsId:"",goodsData:{id:0,name:"",price:"~",number:1,coverImg:"",service:[{name:"正品保证",description:"此商品官方保证为正品"}],spec:{name:"",specItem:[]},freight:0,freeFreight:0,discount:"",salesNum:0,comment:{number:0,userface:"../../static/img/face.jpg",username:"沈姐姐",content:"很不错，之前买了很多次了，很好看，能放很久，和图片色差不大，值得购买！"}},specs:[],specNames:"",selectSpec:[],isKeep:!1,descriptionStr:"",detailHtml:"",skuSure:!0,product:{},showSet:!1,specClass:"none",specifications:[],difference:[],shopItemInfo:{},selectArr:[],subIndex:[],selectshop:{},selectNum:1,targetFunction:"",horizontal:"right",vertical:"bottom",direction:"vertical",fabShow:!1,pattern:{color:"#7A7E83",backgroundColor:"#FFFFFF",selectedColor:"#007AFF",buttonColor:"#f47952",widh:"45px"},content:[{iconPath:"/static/img/tabBar/home.png",selectedIconPath:"/static/img/tabBar/home-on.png",text:"首页",active:!1,path:"/pages/tabBar/home/home"},{iconPath:"/static/img/tabBar/cart.png",selectedIconPath:"/static/img/tabBar/cart-on.png",text:"购物车",active:!1,path:"/pages/tabBar/cart/cart"},{iconPath:"/static/img/tabBar/user.png",selectedIconPath:"/static/img/tabBar/user-on.png",text:"我的",active:!1,path:"/pages/tabBar/user/user"}],deliveryFlag:!1,canvasFlag:!0,posterData:{},shareQrCode:"",shareTitle:"我的态度我的AUU ~好物要分享",shareUserId:null,chatTitle:"AUU产品咨询"}},computed:{canCount:function(){return this.subIndex.some(function(t){return-1===t})}},onShareAppMessage:function(t){return console.log("获取到的分享数据"),console.log(t),null!=t.u&&(this.shareUserId=u),"button"===t.from&&console.log(t),{title:this.shareTitle,path:"/pages/goods/goods?u="+this.userId+"&gid="+this.goodsId}},onShow:function(){},onLoad:function(e){var s=this;if(this.userId=t.getStorageSync("userId"),this.goodsId=t.getStorageSync("currentGoodsId"),console.log(e),console.log("页面分享opetin"),null!=e.scene){var o=decodeURIComponent(e.scene);console.log("scene"),console.log(o);var i=o.split("&");i.length>0&&(this.shareUserId=i[0].replace("u=","")),i.length>1&&(this.goodsId=i[1].replace("gid=",""),e["gid"]=this.goodsId)}null!=e.gid&&(this.goodsId=e.gid),null!=e.u&&(this.shareUserId=e.u),t.setStorageSync("currentGoodsId",this.goodsId),this.loadGoodsInfo();var n=this.provider;t.getProvider({service:"oauth",success:function(t){n=t.provider[0]}}),this.provider=n,"weixin"!=n&&"toutiao"!=n||(null!=this.userId&&""!=this.userId||this.oauthLogin(),t.showShareMenu({withShareTicket:!0,success:function(t){console.log("分享success:"+JSON.stringify(t))},fail:function(t){console.log("分享fail:"+JSON.stringify(t))},complete:function(t){console.log("分享complete:"+JSON.stringify(t))}}),this.checkLoginSession()),this.showBack=!1,this.loadGoodsSku(),this.specifications.map(function(t){s.selectArr.push(""),s.subIndex.push(-1)}),this.hideService()},onReady:function(){this.calcAnchor()},onPageScroll:function(t){this.selectAnchor=t.scrollTop>=this.anchorlist[2].top?2:t.scrollTop>=this.anchorlist[1].top?1:0,this.fabShow=this.selectAnchor>0;var e=375;t.scrollTop=t.scrollTop>e?375:t.scrollTop,this.afterHeaderOpacity=t.scrollTop*(1/e),this.beforeHeaderOpacity=1-this.afterHeaderOpacity,this.beforeHeaderzIndex=t.scrollTop>0?10:11,this.afterHeaderzIndex=t.scrollTop>0?11:10},onReachBottom:function(){t.showToast({title:"正在加载..."}),this.fabShow=!0},mounted:function(){},methods:{checkLoginSession:function(){console.log("当前登录用户"+this.userId),null==this.userId?(t.removeStorageSync("Authorization"),t.removeStorageSync("userId"),this.oauthLogin()):null!=this.shareUserId&&this.toAddShareIntegral()},loadGoodsInfo:function(){var e=this,s=this.goodsId;t.request({url:o.requestURL+"/mall/goods/"+s,data:{},header:{"custom-header":"hello"},success:function(t){if(0==t.data.code&&null!=t.data.data){var s=t.data.data;null!=s.shareTitle&&(e.shareTitle=s.shareTitle),e.goodsData.coverImg=s.coverImgs,e.selectshop.coverImg=e.goodsData.coverImgs,e.buylist[0]=s,e.goodsData.salesNum=s.salesNum,e.goodsData.id=s.id,e.goodsData.price=s.price,e.goodsData.name=s.name,e.goodsData.freeFreight=s.freeFreight,e.goodsData.freight=s.freight,e.goodsData.discount=s.discount,e.goodsData.discountPrice=s.discountPrice,e.chatTitle=s.name+" ~￥"+s.price,e.detailHtml=null==s.detailHtml?"":s.detailHtml;var o=[];if(null!=s.detailImgs){o.push('<p style="text-align: center;">');var i=!0,n=!1,a=void 0;try{for(var r,c=s.detailImgs[Symbol.iterator]();!(i=(r=c.next()).done);i=!0){var l=r.value;o.push('<img src="'+l.value+'" style="max-width:100%;">')}}catch(k){n=!0,a=k}finally{try{i||null==c.return||c.return()}finally{if(n)throw a}}o.push("</p>")}if(e.descriptionStr=o.join(""),e.swiperList=s.imgs,null!=s.ratings&&s.ratings.length>0){var h={number:s.commentNum,userface:null!=s.ratings[0].avatar?s.ratings[0].avatar:"'../../static/img/face.jpg'",username:s.ratings[0].userName,content:s.ratings[0].content};e.goodsData.comment=h}else e.goodsData.comment=[];if(e.goodsData.service=s.serverList,null!=s.specCategory&&s.specCategory.length>0)for(var u in s.specCategory){var d={name:s.specCategory[u].specName,specItem:[]},g=!0,f=!1,p=void 0;try{for(var m,v=s.specCategory[u].specItems[Symbol.iterator]();!(g=(m=v.next()).done);g=!0){var I=m.value;d.specItem.push(I)}}catch(k){f=!0,p=k}finally{try{g||null==v.return||v.return()}finally{if(f)throw p}}e.specs.push(d),e.selectSpec.push({id:0,name:""})}if(null!=s.specCategory&&s.specCategory.length>0){var b={name:s.specCategory[0].specName,specItem:[]},y=!0,S=!1,C=void 0;try{for(var w,A=s.specCategory[0].specItems[Symbol.iterator]();!(y=(w=A.next()).done);y=!0){var D=w.value;b.specItem.push(D.specName)}}catch(k){S=!0,C=k}finally{try{y||null==A.return||A.return()}finally{if(S)throw C}}e.goodsData.spec=b}}}})},loadGoodsSku:function(){var t=this;(0,n.getGoodsSkuList)(this.goodsId).then(function(e){if(0==e.data.code){t.specifications=e.data.data.specList,t.difference=e.data.data.skuList;for(var s=0;s<t.difference.length;s++){null!=t.difference[s].imgs&&t.difference[s].imgs.length>0&&(t.difference[s].coverImgs=t.difference[s].imgs[0].value),t.difference[s].difference=[];var o=!0,i=!1,n=void 0;try{for(var a,r=t.difference[s].sku[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var c=a.value;t.difference[s].difference.push(c.name)}}catch(l){i=!0,n=l}finally{try{o||null==r.return||r.return()}finally{if(i)throw n}}}t.checkItem(),t.checkInpath(-1)}})},joinCart:function(){var e=this,s="";if(this.buylist[0]["specs"]=[],this.buylist[0]["goodsName"]=this.buylist[0].name,this.buylist[0]["number"]=this.selectNum,this.buylist[0]["price"]=this.selectshop.price,this.buylist[0]["skuId"]=this.selectshop.id,this.selectArr.length!=this.specifications.length)return this.targetFunction="cart",this.showSpec(function(){e.toConfirmation()});var o=!0,i=!1,n=void 0;try{for(var a,r=this.selectArr[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var c=a.value;s=s+" "+c}}catch(u){i=!0,n=u}finally{try{o||null==r.return||r.return()}finally{if(i)throw n}}this.specNames=s,this.buylist[0]["specNames"]=s;var l=this.buylist[0];this.deleteProperties(l);var h=[];t.getStorage({key:"cartGoodsList",success:function(t){null!=t.data&&(h=t.data)}}),h.push(l),t.setStorage({key:"cartGoodsList",data:h,success:function(){t.showToast({title:"已加入购物车"})}})},buy:function(){var e=this,s="";if(this.buylist[0]["goodsName"]=this.buylist[0].name,this.buylist[0]["specs"]=[],this.buylist[0]["number"]=this.selectNum,this.buylist[0]["price"]=this.selectshop.price,this.buylist[0]["skuId"]=this.selectshop.id,this.selectArr.length!=this.specifications.length)return this.targetFunction="buy",this.showSpec(function(){e.toConfirmation()});var o=!0,i=!1,n=void 0;try{for(var a,r=this.selectArr[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var c=a.value;s=s+" "+c}}catch(h){i=!0,n=h}finally{try{o||null==r.return||r.return()}finally{if(i)throw n}}this.specNames=s,this.buylist[0]["specNames"]=s;var l=this.buylist[0];this.deleteProperties(l),t.setStorage({key:"buylist",data:[l],success:function(){t.navigateTo({url:"../order/confirmation"})}})},deleteProperties:function(t){delete t.specCategory,delete t.services,delete t.serverList,delete t.ratings,delete t.detailImg,delete t.detailImgs},toConfirmation:function(){var t=[],e={id:this.goodsData.id,img:null!=this.goodsData.coverImgs?this.goodsData.coverImgs:"../../static/img/goods/p1.jpg",name:this.goodsData.name,specNames:"规格:"+this.specNames,price:this.goodsData.price,number:this.goodsData.number};this.buylist[0].img=this.goodsData.coverImgs,this.buylist[0]["number"]=1,this.buylist[0]["goodsPrice"]=this.goodsData.price,t.push(e)},toRatings:function(){if(0==this.goodsData.comment.length)return t.showToast({title:"该商品暂无评论"}),!1;t.navigateTo({url:"/pages/goods/ratings/ratings?gid="+this.goodsId})},skuClick:function(e,s,o,i){if(e.ishow){if(this.selectArr[s]!=e.name?(this.$set(this.selectArr,s,e.name),this.$set(this.subIndex,s,i)):(this.$set(this.selectArr,s,""),this.$set(this.subIndex,s,-1)),this.selectArr.length!=this.specifications.length)return void(this.skuSure=!0);for(var n=0;n<this.selectArr.length;n++)if(""==this.selectArr[n])return void(this.skuSure=!0);if(this.checkInpath(s),this.selectArr.every(function(t){return""!=t})){if(this.selectshop=this.shopItemInfo[this.selectArr],null==this.selectshop)return t.showToast({title:"没有这个规格组合",icon:"none"}),!1;null!=this.selectshop&&null==this.selectshop.coverImgs&&(this.selectshop.coverImgs=this.goodsData.coverImgs),this.selectNum=1}}this.selectArr.length==this.specifications.length&&(this.skuSure=!1,null!=this.selectshop.imgs&&this.selectshop.imgs.length>0&&(this.swiperList=this.selectshop.imgs))},checkInpath:function(t){for(var e=0,s=this.specifications.length;e<s;e++)if(e!=t)for(var o=this.specifications[e].item.length,i=0;i<o;i++)if(-1==this.subIndex[e]||i!=this.subIndex[e]){var n=a(this.selectArr);this.$set(n,e,this.specifications[e].item[i].name);var r=n.filter(function(t){return""!==t&&"undefined"!==typeof t});this.shopItemInfo.hasOwnProperty(r)?this.$set(this.specifications[e].item[i],"ishow",!0):this.$set(this.specifications[e].item[i],"ishow",!1)}},checkItem:function(){var t=this;this.difference.reduce(function(e,s){return e.concat(s.difference.reduce(function(e,o){return e.concat(e.map(function(e){return t.shopItemInfo.hasOwnProperty([].concat(a(e),[o]))||(t.shopItemInfo[[].concat(a(e),[o])]=s),[].concat(a(e),[o])}))},[[]]))},[[]])},trigger:function(e){this.content[e.index].active=!e.item.active,t.switchTab({url:e.item.path})},showComments:function(t){},setSelectSpec:function(t,e,s){this.selectSpec[t]={name:s,id:e}},sub:function(){this.goodsData.number<=1||(this.selectNum--,this.goodsData.number--)},add:function(){this.selectNum++,this.goodsData.number++},toAnchor:function(e){this.selectAnchor=e,t.pageScrollTo({scrollTop:this.anchorlist[e].top,duration:200})},calcAnchor:function(){var e=this;this.anchorlist=[{name:"主图",top:0},{name:"评价",top:0},{name:"详情",top:0}];var s=t.createSelectorQuery().select("#comments");s.boundingClientRect(function(s){var o=0,i=t.upx2px(100);e.anchorlist[1].top=s.top-i-o,e.anchorlist[2].top=s.bottom-i-o}).exec()},back:function(){t.navigateBack()},showService:function(){this.serviceClass="show"},hideService:function(){var t=this;this.serviceClass="hide",setTimeout(function(){t.serviceClass="none"},200)},showSpec:function(t){this.specClass="show",this.specCallback=t},specCallback:function(){},hideSpec:function(){var t=this;this.specClass="hide",this.selectSpec&&this.specCallback&&this.specCallback(),this.specCallback=!1,setTimeout(function(){t.specClass="none"},200)},discard:function(){},submitSku:function(){this.closeSf()},closeSku:function(){var t=this;this.specClass="hide",setTimeout(function(){t.specClass="none"},250)},closeSf:function(){var t=this;this.specClass="hide",setTimeout(function(){t.specClass="none","buy"==t.targetFunction?t.buy():"cart"==t.targetFunction&&t.joinCart()},250)},changeNum:function(t){this.selectNum=parseInt(t)},toggleSpec:function(){this.specClass="show"},swiperChange:function(t){this.currentSwiper=t.detail.current},toMsg:function(){t.navigateTo({url:"../msg/msg"})},toChat:function(){var e={goodsName:this.goodsData.name,goodsImg:this.goodsData.coverImg,goodsId:this.goodsId,price:this.goodsData.price};return t.setStorageSync("msgShowObj",e),t.navigateTo({url:"../msg/chat/index"}),!1},oauthLogin:function(){console.log("开始登录");var e=this.provider,s=this;t.login({provider:e,success:function(i){var n=getApp().globalData.PROVIDER[e];getApp().globalData.APPTYPE=n,t.request({url:o.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+n+"@"+i.code,method:"post",header:{Authorization:getApp().globalData.CLIENT},success:function(e){200==e.statusCode&&(t.setStorageSync("Authorization","Bearer "+e.data.access_token),t.setStorageSync("refreshToken",e.data.refresh_token),t.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),t.setStorageSync("userId",e.data.user_id),t.setStorageSync("userName",e.data.username),s.userId=e.data.user_id,null!=s.shareUserId&&s.toAddShareIntegral())}})},fail:function(e){console.log("用户拒绝了授权: "+JSON.stringify(e)),t.hideLoading()}})},getSysShareQrcode:function(t,e){var s=this,o="",n=this,a=getApp().globalData.wxAppId,r={appId:a,appname:"mini",type:"MINI",userId:this.userId,goodsId:this.goodsId,page:"pages/goods/goods",scene:"u="+this.userId+"&gid="+this.goodsId,is_hyaline:!0};(0,i.getShareQrcode)(r,a).then(function(i){if(console.log(i),0==i.data.code)return n.shareQrCode=i.data.data,s.createCanvasImageEvn(t,e),o}),this.shareQrCode=o},createCanvasImageEvn:function(t,e){var s=this,o=(this.shareQrCode,this.goodsData.coverImg),i=this.goodsData.name,n=null!=this.goodsData.discountPrice?this.goodsData.discountPrice:this.goodsData.price;null==t&&(t="店长小猪"),null==e&&(e=this.goodsData.coverImg),console.log(this.goodsData),Object.assign(this.posterData,{shopName:"AUU旗舰店",url:o,title:i,nickName:t,avatarUrl:e,discountPrice:n,orignPrice:this.goodsData.price,icon:"https://auu.oss-cn-hangzhou.aliyuncs.com/tgj.jpg",code:this.shareQrCode}),console.log(this.posterData),this.$forceUpdate(),setTimeout(function(){s.canvasFlag=!1,s.deliveryFlag=!1,s.$refs.hchPoster.createCanvasImage()},500)},closeShareEvn:function(){this.deliveryFlag=!1},canvasCancel:function(t){this.canvasFlag=t},gotUserInfo:function(t){console.log("获取到用户信息"),console.log(t);var e=t.detail.userInfo,s=e.avatarUrl,o=e.nickName;this.getSysShareQrcode(o,s)},h5gotUserInfo:function(){this.goodsData.coverImg;this.getSysShareQrcode()},toAddShareIntegral:function(){var e={formId:null==this.userId?0:this.userId,goodsId:this.goodsId,userId:this.shareUserId,type:"SHARE",appCpde:getApp().globalData.APPNAME};(0,i.increaseIntegral)(e).then(function(e){0==e.data.code&&e.data.msg&&t.showToast({title:"好友获得"+e.data.data+"积分",icon:"success"})})},hideShare:function(){var t=this;this.shareClass="hide",setTimeout(function(){t.shareClass="none"},150)},keep:function(){this.isKeep=!this.isKeep},toCart:function(){t.switchTab({url:"../tabBar/cart/cart"})},toHome:function(){t.switchTab({url:"../tabBar/cart/cart"})},share:function(){console.log("userId="+this.userId),this.shareClass="show"}}};e.default=f}).call(this,s("543d")["default"])},a61a:function(t,e,s){"use strict";(function(t){s("3075");o(s("66fd"));var e=o(s("06c7"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])},a69d:function(t,e,s){"use strict";s.r(e);var o=s("2929"),i=s.n(o);for(var n in o)"default"!==n&&function(t){s.d(e,t,function(){return o[t]})}(n);e["default"]=i.a},b7d0:function(t,e,s){},fdbb:function(t,e,s){"use strict";var o={"uni-fab":()=>s.e("components/uni-fab/uni-fab").then(s.bind(null,"e60e"))},i=function(){var t=this,e=t.$createElement,s=(t._self._c,t.selectArr.join(" ")),o=t.selectArr.join(" ");t.$mp.data=Object.assign({},{$root:{g0:s,g1:o}})},n=[];s.d(e,"b",function(){return i}),s.d(e,"c",function(){return n}),s.d(e,"a",function(){return o})}},[["a61a","common/runtime","common/vendor"]]]);