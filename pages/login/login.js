(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"1d34":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o("9e95"),n=o("a3ea"),r=o("cf36");i(o("f025"));function i(e){return e&&e.__esModule?e:{default:e}}var s={data:function(){return{phoneNumber:"",passwd:"",isShowOauth:!0,showProvider:{weixin:!1,qq:!1,toutiao:!1,sinaweibo:!1,xiaomi:!1},face:"",provider:""}},onShow:function(){},onLoad:function(){this.getProvider(),this.getLogo()},methods:{getphonenumber:function(e){console.log(e)},oauthLogin:function(t){var o=this;e.showLoading({title:"正在登录..."}),e.login({provider:t,success:function(e){o.loginByCode(e.code)},fail:function(t){console.log("fail: "+JSON.stringify(t)),e.hideLoading()}})},loginByCode:function(t){var o=getApp().globalData.APPTYPE;e.request({url:a.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+o+"@"+t,method:"post",header:{Authorization:getApp().globalData.CLIENT},success:function(t){if(e.hideLoading(),console.log(t),401===t.statusCode)return e.showToast({title:"该账号还未绑定",icon:"none"}),setTimeout(function(){e.hideKeyboard(),e.navigateTo({url:"bind?state="+o+"&code=auu"})},500),!1;200==t.statusCode&&(e.setStorageSync("Authorization","Bearer "+t.data.access_token),e.setStorageSync("TENANT-ID",t.data.tenant_id),e.setStorageSync("refreshToken",t.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",t.data.user_id),e.setStorageSync("userName",t.data.username),e.showToast({title:"登录成功",icon:"success"}),setTimeout(function(){e.navigateBack()},300))}})},getProvider:function(){var t=this;e.getProvider({service:"oauth",success:function(e){console.log(e);for(var o=e.provider.length,a=0;a<o;a++)t.showProvider[e.provider[a]]=!0;0==e.provider.length&&(t.isShowOauth=!1),t.provider=e.provider[0],getApp().globalData.APPTYPE=getApp().globalData.PROVIDER[e.provider[0]]}})},toPage:function(t){e.hideKeyboard(),e.navigateTo({url:t})},getLogo:function(){var e=this;(0,r.getParam)("_LOGO").then(function(t){console.log(t),e.face=t.data.data})},doLogin:function(){if(e.hideKeyboard(),!/^1(3|4|5|6|7|8|9)\d{9}$/.test(this.phoneNumber))return e.showToast({title:"请填写正确手机号码",icon:"none"}),!1;e.showLoading({title:"登录中..."});var t={password:this.passwd},o=(0,n.encryption)({data:t,key:"pigxpigxpigxpigx",param:["password"]});o=(0,n.URLencode)(o.password);var r="/auth/oauth/token?password="+o+"&username="+this.phoneNumber+"&randomStr=1&code=1&grant_type=password&scope=server";e.request({url:a.requestURL+r,data:{},header:{Authorization:getApp().globalData.CLIENT,client:"auu"},method:"POST",success:function(t){if(console.log(t),null!=t.data.code&&1==t.data.code)return e.showToast({title:t.data.msg?t.data.msg:"账号或密码不正确",icon:"none"}),!1;200==t.statusCode&&(console.log(t.data),e.setStorageSync("Authorization","Bearer "+t.data.access_token),e.setStorageSync("TENANT-ID",t.data.tenant_id),e.setStorageSync("refreshToken",t.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",t.data.user_id),e.setStorageSync("userName",t.data.username),e.showToast({title:"登录成功",icon:"success"}),setTimeout(function(){e.switchTab({url:"/pages/tabBar/home/home"})},200),console.log("登录完成"))},fail:function(e){console.log("登录错误了")}})}}};t.default=s}).call(this,o("543d")["default"])},"386a":function(e,t,o){"use strict";var a,n=function(){var e=this,t=e.$createElement;e._self._c},r=[];o.d(t,"b",function(){return n}),o.d(t,"c",function(){return r}),o.d(t,"a",function(){return a})},"393e":function(e,t,o){"use strict";o.r(t);var a=o("386a"),n=o("3a61");for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);o("a805");var i,s=o("f0c5"),u=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);t["default"]=u.exports},"3a61":function(e,t,o){"use strict";o.r(t);var a=o("1d34"),n=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);t["default"]=n.a},"531e":function(e,t,o){"use strict";(function(e){o("3075");a(o("66fd"));var t=a(o("393e"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},a805:function(e,t,o){"use strict";var a=o("adfd"),n=o.n(a);n.a},adfd:function(e,t,o){}},[["531e","common/runtime","common/vendor"]]]);