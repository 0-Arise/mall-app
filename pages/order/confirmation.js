(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/confirmation"],{"0c38":function(e,t,o){"use strict";o.r(t);var n=o("d893"),i=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,function(){return n[e]})}(s);t["default"]=i.a},"7fe7":function(e,t,o){"use strict";o.r(t);var n=o("c0c4"),i=o("0c38");for(var s in i)"default"!==s&&function(e){o.d(t,e,function(){return i[e]})}(s);o("f98a");var r,a=o("f0c5"),c=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);t["default"]=c.exports},"95ef":function(e,t,o){},c0c4:function(e,t,o){"use strict";var n,i=function(){var e=this,t=e.$createElement,o=(e._self._c,e._f("toFixed")(e.deduction)),n=e._f("toFixed")(e.goodsPrice),i=e._f("toFixed")(e.freight),s=e._f("toFixed")(e.deduction),r=e._f("toFixed")(e.sumPrice);e.$mp.data=Object.assign({},{$root:{f0:o,f1:n,f2:i,f3:s,f4:r}})},s=[];o.d(t,"b",function(){return i}),o.d(t,"c",function(){return s}),o.d(t,"a",function(){return n})},d381:function(e,t,o){"use strict";(function(e){o("3075");n(o("66fd"));var t=n(o("7fe7"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},d893:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("9e95"),i=(o("e228"),o("39f7")),s={data:function(){return{baseUrl:n.requestURL,userId:null,buylist:[],goodsPrice:0,sumPrice:0,freight:0,note:"",int:0,deduction:0,provider:"",recinfo:{cityName:"",countyName:"",detailInfo:"",provinceName:"",contactPhone:"",contactUserName:"选择收件人",receiveInf:""}}},onShow:function(){var t=this;console.log("onShow"),e.getStorage({key:"buylist",success:function(e){t.buylist=e.data,t.goodsPrice=0,t.freight=0;for(var o=t.buylist.length,n=0;n<o;n++)t.freight=t.freight+t.buylist[n].freight,t.goodsPrice=t.goodsPrice+t.buylist[n].number*t.buylist[n].price;t.deduction=t.int/100,t.sumPrice=t.freight+t.goodsPrice-t.deduction}}),e.getStorage({key:"selectAddress",success:function(e){console.log(e),t.recinfo=e.data},fail:function(e){console.log("获取地址失败")}})},onHide:function(){console.log("onHide")},onLoad:function(){console.log("onload");var t=this.provider;null!=t&&""!=t||(e.getProvider({service:"oauth",success:function(e){t=e.provider[0]}}),this.provider=t),this.userId=e.getStorage("userId"),null!=this.userId&&""!=this.userId||this.oauthLogin();var o=e.getStorage("Authorization");console.log(o),null!=o&&""!=o||this.oauthLogin()},onBackPress:function(){this.clearOrder()},filters:{toFixed:function(e){return parseFloat(e).toFixed(2)}},methods:{oauthLogin:function(t){var o=this,i=this.provider;console.log("开始登陆账号:"+i),e.login({provider:i,success:function(s){console.log(s);var r=getApp().globalData.PROVIDER[i];e.request({url:n.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+r+"@"+s.code,method:"post",header:{Authorization:getApp().globalData.CLIENT},success:function(n){if(401===n.statusCode)return setTimeout(function(){e.hideKeyboard(),e.navigateTo({url:"bind?state="+r+"&code=auu"})},300),!1;200==n.statusCode&&(console.log(n),e.setStorageSync("Authorization","Bearer "+n.data.access_token),e.setStorageSync("TENANT-ID",n.data.tenant_id),e.setStorageSync("refreshToken",n.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",n.data.user_id),e.setStorageSync("userName",n.data.username),t&&o.toPay())}})},fail:function(t){console.log("用户拒绝了授权: "+JSON.stringify(t)),e.hideLoading()}})},clearOrder:function(){var t=this;e.removeStorage({key:"buylist",success:function(e){t.buylist=[]}})},toPay:function(){var t=this;if(this.userId=e.getStorageSync("userId"),null==this.userId||""==this.userId)return this.oauthLogin(!0),!1;var o=e.getStorageSync("Authorization");if(console.log(o),""==o)return this.oauthLogin(!0),!1;for(var n=[],s=[],r=this.buylist.length,a=0;a<r;a++)n.push(this.buylist[a]),s.push(this.buylist[a].id);if(0!=n.length){e.showLoading({title:"正在提交订单..."});var c=e.getStorageSync("address");if(""==c)return this.selectAddress(),e.hideLoading(),!1;var d={paymentPrice:this.sumPrice,note:this.note,goodsPrice:this.goodsPrice,integral:this.int,deduction:this.deduction,receiveAddId:c.id,receiveInf:"",specsNames:n[0].specNames,goodsId:n[0].id,skuId:n[0].skuId,appCode:getApp().globalData.APPNAME};Object.assign(d,n[0],this.recinfo),this.deleteProperties(d),console.log(d),(0,i.saveOrder)(d).then(function(o){if(0==o.data.code&&null!=o.data.data)return d.id=o.data.data.id,void e.setStorage({key:"paymentOrder",data:n,success:function(){e.hideLoading(),e.redirectTo({url:"../pay/payment/payment?amount="+t.sumPrice+"&goodsId="+d.goodsId+"&orderName="+d.goodsName+"&orderId="+d.id})}})})}else e.showToast({title:"订单信息有误，请重新购买",icon:"none"})},selectAddress:function(){e.chooseAddress({success:function(t){var o={cityName:t.cityName,countyName:t.countyName,detailInfo:t.detailInfo,provinceName:t.provinceName,contactPhone:t.telNumber,contactUserName:t.userName,nationalCode:t.nationalCode,receiveInf:t.provinceName+" "+t.cityName+" "+t.countyName};console.log(this);var n=[];e.getStorage({key:"addressList",success:function(e){n=e.data,n.push(o)}}),e.setStorageSync("addressList",n),e.setStorageSync("address",o),e.setStorageSync("selectAddress",o)},fail:function(e){console.log("获取地址失败了")}})},deleteProperties:function(e){delete e.releaseTime,delete e.updateTime,delete e.status,delete e.slogan,delete e.img,delete e.salesNum,delete e.inventory,delete e.id},checkUserSession:function(){console.log("获取到的UserId:"+this.userId)}}};t.default=s}).call(this,o("543d")["default"])},f98a:function(e,t,o){"use strict";var n=o("95ef"),i=o.n(n);i.a}},[["d381","common/runtime","common/vendor"]]]);