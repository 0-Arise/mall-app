(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/user/user"],{"360f":function(e,t,n){"use strict";n.r(t);var o=n("87c7"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=a.a},"4c78":function(e,t,n){"use strict";n.r(t);var o=n("fb56"),a=n("360f");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("a870");var s,r=n("f0c5"),u=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);t["default"]=u.exports},"87c7":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("9e95"),a=n("e228"),i=n("7416"),s={data:function(){return{userId:null,baseUrl:o.requestURL,isfirst:!0,headerPosition:"fixed",headerTop:null,statusTop:null,showHeader:!0,vipName:getApp().globalData.APPNAME,user:{name:"AUU用户",face:"/static/img/face.jpg",signature:"点击昵称跳转登录/注册页",integral:0,balance:0,envelope:0},orderList:[{text:"待付款",icon:"fukuan",id:"UNPAID"},{text:"待发货",icon:"fahuo",id:"BACK"},{text:"待收货",icon:"shouhuo",id:"UNRECEIVED"},{text:"待评价",icon:"pingjia",id:"RECEIVED"},{text:"退换货",icon:"tuihuo",id:"REFUNDS"}],mytoolbarList:[{url:"../../user/address/address",text:"收货地址",img:"/static/img/user/addr.png",id:"address"},{url:"/pages/login/login",text:"账户安全",img:"/static/img/user/security.png",id:"login"},{url:"../../user/keep/keep",text:"我的收藏",img:"/static/img/user/point.png",id:"keep"},{id:"coupon",url:"../../user/coupon/coupon",text:"优惠券",img:"/static/img/user/quan.png"}],page:{total:0,current:1,size:10,pages:10,orders:[]},loadingText:"正在加载...",likeList:[],likeMarginTop:"1px",provider:null}},onPullDownRefresh:function(){setTimeout(function(){e.stopPullDownRefresh()},1e3)},onPageScroll:function(e){this.headerPosition=e.scrollTop>=0?"fixed":"absolute",this.headerTop=e.scrollTop>=0?null:0,this.statusTop=e.scrollTop>=0?null:-this.statusHeight+"px"},onShow:function(){this.checkLoginSession()},onLoad:function(){this.userId=e.getStorageSync("userId"),this.statusHeight=0;var t=this.provider;null!=t&&""!=t||(e.getProvider({service:"oauth",success:function(e){t=e.provider[0]}}),this.provider=t),"toutiao"==t&&e.authorize({scope:"scope.userInfo",success:function(){this.getSocisallUserInfo()},fail:function(e){console.log(e)}}),this.loadGoodsList()},onReady:function(){},methods:{checkLoginSession:function(){if(console.log("当前登录用户"+this.userId),null!=this.userId)return this.loadUserMallInfo(),!1;e.removeStorageSync("Authorization"),this.oauthLogin()},oauthLogin:function(){var t=this,n=this.provider;e.login({provider:n,success:function(a){console.log(a);var i=getApp().globalData.PROVIDER[n];getApp().globalData.APPTYPE=i,e.request({url:o.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+i+"@"+a.code,method:"post",header:{Authorization:getApp().globalData.CLIENT},success:function(n){e.setStorageSync("Authorization","Bearer "+n.data.access_token),e.setStorageSync("TENANT-ID",n.data.tenant_id),e.setStorageSync("refreshToken",n.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",n.data.user_id),e.setStorageSync("userName",n.data.username),t.userId=n.data.user_id,t.loadUserMallInfo()}})},fail:function(t){console.log("用户拒绝了授权: "+JSON.stringify(t)),e.hideLoading()}}),console.log("登录成功：userid:"+this.userId)},getSocisallUserInfo:function(){var t=this;this.user;e.getUserInfo({provider:this.provider,success:function(n){console.log("开始获取社交用户信息成功"),console.log(n),t.user.face=n.userInfo.avatarUrl,t.user.name=n.userInfo.nickName,e.setStorageSync("avatar",n.userInfo.avatarUrl),e.setStorageSync("name",n.userInfo.nickName);var o={name:n.userInfo.nickName,face:n.userInfo.avatarUrl,signature:"拒绝随波逐流，各凭态度乘风浪",integral:0,balance:0,envelope:0};o,e.setStorageSync("SocUserInfo",o)},fail:function(e){console.log("开始获取社交用户信息失败"),console.log(e)}})},loadGoodsList:function(){var e=this,t={current:this.page.current,size:this.page.size,type:"2"};Object.assign(t,this.page),(0,i.getGoodsList)(t).then(function(t){if(0==t.data.code&&null!=t.data.data&&(e.page.currentPage=t.data.data.current,e.page.pages=t.data.data.pages,(e.page.current=1)&&(e.likeList=[]),t.data.data.records.length>0)){var n=t.data.data.records;n.length%2!=0&&n.pop();var o=!0,a=!1,i=void 0;try{for(var s,r=n[Symbol.iterator]();!(o=(s=r.next()).done);o=!0){var u=s.value;e.likeList.push(u)}}catch(c){a=!0,i=c}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}}e.loadingText=""})},loadUserInfo:function(){(0,a.getUserInfo)(this.userId).then(function(e){if(0==e.data.code&&null!=e.data.data)e.data.data})},loadUserMallInfo:function(){var e=this;(0,a.getUserMallInfo)(this.userId).then(function(t){if(0==t.data.code&&null!=t.data.data){var n=Object.assign(e.user,t.data.data);console.log(n),e.user=Object.assign(t.data.data,e.user)}})},toSignin:function(){var t=this;if(null==this.userId)return e.showToast({title:"您还未登录，请先登录",icon:"none"}),!1;var n={appCpde:getApp().globalData.appCode,fromId:0,userId:this.userId,type:"SIGN"};(0,a.increaseIntegral)(n).then(function(n){0==n.data.code&&e.showToast({title:n.data.msg?n.data.msg:"签到成功",icon:"success"}),null!=n.data.data&&n.data.data>0&&(t.user.integral+=n.data.data)})},toMsg:function(){e.showToast({title:"该功能尚未开通",icon:"none"})},toOrderList:function(t){if(null==this.userId)return e.showToast({title:"您还未登录，请先登录",icon:"none"}),!1;e.setStorageSync("tbIndex",t),e.navigateTo({url:"../../user/order_list/order_list?tbIndex="+t})},toIntegralList:function(t,n){if(null==this.userId)return e.showToast({title:"您还未登录，请先登录",icon:"none"}),!1;e.navigateTo({url:"../../user/integral/integral_list?categroy="+t+"&title="+n})},toSetting:function(){e.navigateTo({url:"../../user/setting/setting"})},toMyQR:function(){e.navigateTo({url:"../../user/myQR/myQR"})},toLogin:function(){e.navigateTo({url:"../../login/login"}),this.isfirst=!1},toGoods:function(t){e.navigateTo({url:"../../goods/goods?gid="+t.goodsId})},isLogin:function(){var t=e.getStorageSync("UserInfo");return!!t},toDeposit:function(){e.navigateTo({url:"../../user/deposit/deposit"})},toOriagnAddress:function(){e.chooseAddress({success:function(t){var n={cityName:t.cityName,countyName:t.countyName,detailInfo:t.detailInfo,provinceName:t.provinceName,contactPhone:t.telNumber,contactUserName:t.userName,nationalCode:t.nationalCode,receiveInf:t.provinceName+" "+t.cityName+" "+t.countyName},o=[];e.getStorage({key:"addressList",success:function(e){o=e.data,o.push(n)}})}})},toPage:function(t,n){if("address"==n)return this.toOriagnAddress(),!1;t?e.navigateTo({url:t}):e.showToast({title:"模板未包含此页面",icon:"none"})},countMargin:function(){var e=2;e<1&&(e=0),this.likeMarginTop=e+"%"}}};t.default=s}).call(this,n("543d")["default"])},"9ed1":function(e,t,n){},a870:function(e,t,n){"use strict";var o=n("9ed1"),a=n.n(o);a.a},bc51:function(e,t,n){"use strict";(function(e){n("3075");o(n("66fd"));var t=o(n("4c78"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},fb56:function(e,t,n){"use strict";var o,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o})}},[["bc51","common/runtime","common/vendor"]]]);